{"version":3,"sources":["airtable/create.js","firebase/firebase.js","firebase/AddToDB.js","inputStyled.js","InputData.js","airtable/receive.js","airtable/verify.js","style.js","App.js","index.js"],"names":["firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","AddToDB","studentInformation","console","log","infoDetail","fields","截止时间fomula","报课时间","moment","toDate","是否结课","余款","EnrolDate","课程预计时间","老师","课程选择","课程","verify","targetToSet","attendTime","Date","now","airtableId","id","balance","course","created","studentId","Id","studentName","name","teacher","firestore","collection","add","setToFirebase","DivWrapper","styled","div","TitleWrapper","InputWrapper","input","InputData","useState","disabled","setDisabled","autoFocus","onKeyPress","e","inputValue","target","value","which","record","Promise","resolve","reject","then","result","window","location","reload","getStudent","inputId","base","require","filterByFormula","concat","select","view","firstPage","GetStudentId","res","Verify","length","dateAttend","thisDate","toISOString","substring","dataToCreate","Student","create","CreateRecord","handleChange","GlobalStyled","createGlobalStyle","App","className","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.3acd6019.chunk.js","sourcesContent":["export const CreateRecord = studentId => {\n  var Airtable = require('airtable');\n  var base = new Airtable({ apiKey: 'key3fX4iWEdGotDwW' }).base(\n    'appvWyF7JgnpEYfm2'\n  );\n\n  const dataToCreate = [\n    {\n      fields: {\n        Student: [studentId]\n      }\n    }\n  ];\n  // console.log('没有创建记录 请注释create.js');\n  // return '001';\n  return base('签到表').create(dataToCreate);\n};\n","import firebase from 'firebase/app';\nimport 'firebase/firestore';\n\nconst firebaseConfig = {\n  apiKey: 'AIzaSyCNGVUhArvmU2d-A3c-EwjyDvba2V11loI',\n  authDomain: 'attendance-2964a.firebaseapp.com',\n  databaseURL: 'https://attendance-2964a.firebaseio.com',\n  projectId: 'attendance-2964a',\n  storageBucket: 'attendance-2964a.appspot.com',\n  messagingSenderId: '531892612233',\n  appId: '1:531892612233:web:e4373e4b10125686386a58',\n  measurementId: 'G-1L4R52SJVK'\n};\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\n\nexport default firebase;\n","import firebase from './firebase';\nimport * as moment from 'moment';\n\nexport const AddToDB = studentInformation => {\n  console.log('add to db:', studentInformation);\n  let infoDetail = studentInformation.fields;\n  console.log('to数据库 : ', infoDetail);\n  console.log('时间测试: ', infoDetail.截止时间fomula == null);\n  console.log('时间测试: ', infoDetail.报课时间 == null);\n  console.log('时间测试: ', moment(null).toDate());\n\n  infoDetail = verify(infoDetail);\n  let targetToSet = {\n    attendTime: moment(Date.now()).toDate(),\n    airtableId: studentInformation.id,\n    balance: infoDetail.余款,\n    course: infoDetail.课程[0],\n    created: moment(Date.now()).toDate(),\n    studentId: infoDetail.Id,\n    studentName: infoDetail.name,\n    teacher: infoDetail.老师[0]\n  };\n  if (infoDetail.是否结课 != null) {\n    targetToSet['isFinished'] = infoDetail.是否结课;\n  }\n  if (infoDetail.报课时间 != null) {\n    targetToSet['enrolDate'] = moment(infoDetail.报课时间).toDate();\n  }\n  if (infoDetail.截止时间fomula != null) {\n    targetToSet['estimatedFinish'] = moment(infoDetail.截止时间fomula).toDate();\n  }\n  console.log(targetToSet);\n  setToFirebase(targetToSet);\n};\n\nfunction verify(infoDetail) {\n  if (infoDetail.是否结课 === '未结课') {\n    infoDetail.是否结课 = false;\n  } else {\n    infoDetail.是否结课 = true;\n  }\n  if (infoDetail.余款 == null) {\n    infoDetail.余款 = '/';\n  }\n  if (infoDetail.EnrolDate == null || infoDetail.课程预计时间 == null) {\n    infoDetail.EnrolDate = ['仍未选择'];\n  }\n  if (infoDetail.老师 == null) {\n    infoDetail.老师 = ['仍未选择'];\n  }\n  if (infoDetail.课程选择 == null) {\n    infoDetail.课程 = ['仍未选择'];\n  }\n\n  return infoDetail;\n}\n\nfunction setToFirebase(targetToSet) {\n  let db = firebase.firestore();\n  db.collection('attendance_production').add(targetToSet);\n}\n","import styled from 'styled-components';\n\nexport const DivWrapper = styled.div`\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin-top: -50px;\n  margin-left: -150px;\n`;\n\nexport const TitleWrapper = styled.div`\n  width: 100%;\n  display: block;\n  font-family: Tahoma;\n  font-size: 39px;\n  color: #555555;\n  line-height: 1.2;\n  text-align: center;\n`;\n\nexport const InputWrapper = styled.input`\n  outline-style: none;\n  border: 1px solid #ccc;\n  border-radius: 3px;\n  padding: 13px 14px;\n  width: 280px;\n  font-size: 14px;\n  font-weight: 700;\n  font-family: 'Microsoft soft';\n`;\n","import React, { useState } from 'react';\nimport { GetStudentId } from './airtable/receive';\nimport { CreateRecord } from './airtable/create';\nimport { Verify } from './airtable/verify';\nimport { AddToDB } from './firebase/AddToDB';\nimport { TitleWrapper, DivWrapper, InputWrapper } from './inputStyled';\n\nconst InputData = () => {\n  const [disabled, setDisabled] = useState(false);\n  return (\n    <div>\n      <DivWrapper>\n        <TitleWrapper>钢琴公寓签到</TitleWrapper>\n        <InputWrapper\n          autoFocus\n          onKeyPress={e => handleChange(e, setDisabled)}\n          disabled={disabled}\n        />\n      </DivWrapper>\n    </div>\n  );\n};\n\nconst getStudent = record => {\n  return new Promise((resolve, reject) =>\n    record.then(result => {\n      if (result[0] != null && result[0].id != null) {\n        const studentInformation = result[0];\n        console.log('result is:', studentInformation);\n        resolve(studentInformation);\n      } else {\n        reject('no student is retrieved from airtable');\n        window.location.reload();\n      }\n    })\n  );\n};\n\nconst verify = studentInformation => {\n  return new Promise((resolve, reject) =>\n    Verify(studentInformation).then(result => {\n      console.log('verify: ', result);\n      if (result.length > 0) {\n        const dateAttend = result[result.length - 1].fields.created;\n        console.log('latest: ', dateAttend);\n        const dt = new Date();\n        const thisDate = dt.toISOString().substring(0, 10);\n        console.log('this date: ', thisDate);\n        if (thisDate === dateAttend) {\n          console.log('already attended');\n          window.location.reload();\n          reject('already attended');\n        }\n        console.log('verified');\n        resolve(studentInformation);\n      } else {\n        console.log('new record');\n        resolve(studentInformation);\n      }\n    })\n  );\n};\n\nfunction handleChange(e, setDisabled) {\n  const inputValue = e.target.value;\n  console.log('input', e.target.which);\n  if (e.which === 13) {\n    console.log('扫码机');\n    console.log(inputValue);\n    setDisabled(true);\n    let record = GetStudentId(inputValue);\n    let studentInformation = getStudent(record);\n    let verifyOutcome = studentInformation.then(res => {\n      if (res.fields != null) {\n        let studentInformation = res;\n        return verify(studentInformation);\n      } else {\n        console.log('has no result');\n        window.location.reload();\n      }\n    });\n\n    verifyOutcome.then(res => {\n      console.log('res is: ', res);\n      let studentInformation = res;\n      AddToDB(studentInformation);\n      let created = CreateRecord(studentInformation.id);\n      created.then(result => {\n        console.log('sign in, record is: ', result);\n        window.location.reload();\n      });\n    });\n  }\n}\n\nexport default InputData;\n","export function GetStudentId(inputId) {\n  var Airtable = require(\"airtable\");\n  var base = new Airtable({ apiKey: \"key3fX4iWEdGotDwW\" }).base(\n    \"appvWyF7JgnpEYfm2\"\n  );\n  var filterByFormula = \"AND(Id='\".concat(inputId).concat(\"')\");\n\n  return base(\"basic\")\n    .select({ filterByFormula, view: \"RawData\" })\n    .firstPage();\n}\n","export const Verify = studentInformation => {\n  var Airtable = require('airtable');\n  var base = new Airtable({ apiKey: 'key3fX4iWEdGotDwW' }).base(\n    'appvWyF7JgnpEYfm2'\n  );\n  let name = studentInformation.fields.name;\n  console.log('name: ', name);\n  let filterByFormula = \"AND(name='\".concat(name).concat(\"')\");\n  let outputList = base('签到表')\n    .select({\n      filterByFormula,\n      view: 'Grid view',\n      fields: ['created', 'Student']\n    })\n    .firstPage();\n  return outputList;\n};\n","import { createGlobalStyle } from 'styled-components';\n\nexport const GlobalStyled = createGlobalStyle`\n    /* reset.css */\n    html, body, div, span, applet, object, iframe,\n    h1, h2, h3, h4, h5, h6, p, blockquote, pre,\n    a, abbr, acronym, address, big, cite, code,\n    del, dfn, em, img, ins, kbd, q, s, samp,\n    small, strike, strong, sub, sup, tt, var,\n    b, u, i, center,\n    dl, dt, dd, ol, ul, li,\n    fieldset, form, label, legend,\n    table, caption, tbody, tfoot, thead, tr, th, td,\n    article, aside, canvas, details, embed, \n    figure, figcaption, footer, header, hgroup, \n    menu, nav, output, ruby, section, summary,\n    time, mark, audio, video {\n        margin: 0;\n        padding: 0;\n        border: 0;\n        font-size: 100%;\n        font: inherit;\n        vertical-align: baseline;\n    }\n    /* HTML5 display-role reset for older browsers */\n    article, aside, details, figcaption, figure, \n    footer, header, hgroup, menu, nav, section {\n        display: block;\n    }\n    body {\n\n        background-color: #2196F3;\n        line-height: 1;\n    }\n    ol, ul {\n        list-style: none;\n    }\n    blockquote, q {\n        quotes: none;\n    }\n    blockquote:before, blockquote:after,\n    q:before, q:after {\n        content: '';\n        content: none;\n    }\n    table {\n        border-collapse: collapse;\n        border-spacing: 0;\n    }\n`;\n","import React from 'react';\nimport InputData from './InputData';\nimport { GlobalStyled } from './style.js';\n\nfunction App() {\n  return (\n    <div className='App'>\n      <GlobalStyled />\n      <InputData />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}